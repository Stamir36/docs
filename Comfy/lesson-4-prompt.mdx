---
title: "Промпты, негативы и параметры сэмплера"
description: "Как управлять запросами и управлять результатом: промпты, CFG, шаги, сэмплеры, семена и веса в ComfyUI"
---

<Info>
Этот урок подходит как для Stable Diffusion 1.5, так и для SDXL. Для SDXL описаны особенности работы с двойным текстовым энкодером.
</Info>

## Что такое промпт и где его задавать

Используются две ноды:
- **CLIP Text Encode (Prompt)** — положительный промпт.
- **CLIP Text Encode (Negative)** — негативный промпт, задаёт, чего не должно быть.

Они подключаются к **KSampler**, где происходит денойзинг — создание изображения из шума.


## Структура эффективного промпта

Рекомендуемая последовательность:
```
СУТЬ → АТРИБУТЫ → СЦЕНА → СВЕТ/КАМЕРА → СТИЛЬ/НОСИТЕЛЬ → ПОСТ-ОБРАБОТКА
```

**Пример**:
```text
a red fox standing on mossy stones in a misty forest at dawn,
soft volumetric light, shallow depth of field, 85mm lens, photo-realistic,
fine detail, film grain
```

<Note>
Не нужно злоупотреблять словами вроде “masterpiece, best quality” — они часто не добавляют полезной детализации.
</Note>

## Как усиливать или ослаблять элементы

Используйте весовые конструкции:
- `(промпт)` — усиливает (~×1.1).
- `[промпт]` — ослабляет (~×0.9).
- `(промпт:1.3)` — явный вес.
- Повторы слова тоже увеличивают внимание к нему.

```text
portrait of a (red fox:1.3), [background trees], soft rim light
```

<Tip>
Не усиливайте сразу всё — сосредоточьтесь на 1–3 ключевых элементах, чтобы избежать артефактов.
</Tip>

## Негативный промпт: зачем и как

Используется для исключения нежелательного: лишние пальцы, артефакты, размытость, и т.п.

```text
negative: blurry, extra fingers, deformed hands, low contrast, jpeg artifacts
```

<AccordionGroup>
  <Accordion title="Советы по негативу">
    - Давайте конкретный негатив под задачу (напр.: "cross-eye", "bad anatomy").  
    - Не перегружайте — слишком много негативов может конфликтовать с промптом.
    - Альтернатива: подключать Empty Negative через embeddings (например EasyNegative).
  </Accordion>
  <Accordion title="Когда негатив можно пропустить">
    Если изображение чистое и соответствует промпту, негатив можно и не задавать.
  </Accordion>
</AccordionGroup>

## Ограничения на длину промпта

- SD-модели ограничены ≈ 77 токенами.
- SDXL имеет два энкодера (G и L), по ~77 токенов каждый.

<Info>
В данном случае, мы работаем с SDXL.
В SDXL: длинные описания скорее вредны — лучше кратко и по существу.
</Info>

<Tip>
Начните с короткой фразы, проверяйте результат, добавляйте детали постепенно.
</Tip>

## Что настраивать в KSampler

<Columns cols={2}>
  <Card title="Steps (шаги)">
    Чем больше шагов — детальнее результат, но перестаёт давать прогресс сверх ~30–40 (для SD 1.5).
    SDXL база: 25–40; Refiner: меньше.
  </Card>
  <Card title="CFG (guidance scale)">
    Контроль соответствия промпту.   
    ~6–8 — базовый диапазон.
    Меньше — креативнее, выше — строгий промпт.
  </Card>
  <Card title="Sampler">
    Предпочтительно: DPM++ 2M / DPM++ 2M SDE с Karras scheduler для плавного результата.
  </Card>
  <Card title="Scheduler">
    Karras (плавные сигмы) или Normal/Exponential.
  </Card>
</Columns>

Другие важные поля:
- **Seed** — фиксируйте для воспроизводимости, меняйте ради вариаций.
- **Denoise** — в img2img и Refiner: 0.2–0.8 регулирует перерисовку.
- **Batch size / Count** — количество изображений за запуск.
- **Clip Skip** — настраивается через `ClipSetLastLayer`, помогает улучшить баланс текста и изображения.

![KSampler](/images/ComfyUI/IMG_009.png)


## SDXL: два прохода — Base и Refiner

Для увеличения деталей на изображении используется два прохода.

Комбинация:
1. **Base**: полный проход, основное изображени.
2. **Refiner**: частично перерисовывает, добавляет текстуру.

<Steps>
  <Step title="Base проход">
    Настройки: 25–40 шагов, CFG ~6–8, sampler DPM++ 2M, scheduler Karras.
  </Step>
  <Step title="Refiner">
    Используйте тот же seed, Denoise ~0.2–0.35, другой CFG для чистоты/деталей.
  </Step>
</Steps>

![Два KSampler подряд](/images/ComfyUI/IMG_010.png)

<Tip>
На практике мы не будем это использовать, так как этот подход является частью другой технологии, называемой HirezFix.
- HirezFix помогает увеличисть разрешение изображения и дорисовать детали. Получается качество + детали.
</Tip>

---

<Note>
Отлично! Вы теперь прокачались до глубокого уровня промптинга: научились управлять весами, сэмплером, шагами.
</Note>